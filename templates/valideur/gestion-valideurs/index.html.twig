{% extends "bases/crous-base.html.twig" %}

{% block subnavbar %}
	<nav class="subnavbar-crous">
		<div class="previous-link">
			<a href="{{ path('home') }}">Page précédente</a>
		</div>
		<div class="subnavbar-title">
			<h1>Gestion des valideurs</h1> 
			<p>
				<em>Choisir un service pour lequel vous avez les droits de valideur. Si vous n'avez pas les droits, vous pouvez toujours consulter ce service et connaître qui possède actuellement les droits de valideur</em>
			</p>
		</div>
	</nav>
{% endblock %}

{% block body %}
{% if app.user.isAdmin()  or app.user.isDSI() %}
<div class="search-box">
	<p><strong>Rechercher un service</strong></p>
	{{ form_start(form) }}
		{{ form_widget(form.q) }}
		<button type="submit" class="btn btn-primary w-100">Filtrer</button>
	{{ form_end(form) }}
</div>
{% endif %}

{% include "bases/_display-flashes.html.twig" %}

<div class="cards-crous">
	{% for service in services %}
	<div class="card">
		<div class="card-body">
			<h5 class="text-center card-title"><span>{{ service.code }}</span> : {{ service.libelle_court }}</h5>
			<div class="card-current-validator">{{ service.getNumberOfCurrentValidator() }} valideur{% if service.getNumberOfCurrentValidator() > 1 %}s{% endif %} actuellement</div>
			{% if app.user.isValidator(service.id) %}<div class="card-you">(dont vous)</div>{% endif %}
			<p class="card-libelle-long">{{ service.libelle_long }}</p>
			
			{% if app.user.isValidator(service.id) or app.user.isDSI() or app.user.isAdmin() %}
			<div class="status-btn modify" onclick="location.href='{{ path('valideur.gestion-valideurs.service', {'id': service.id}) }}';">
				Gérer les valideurs
			</div>
			{% else %}
			<div class="status-btn show" onclick="location.href='{{ path('agent.connaitre-valideurs', {'id': service.id}) }}';">
				Connaître les valideurs
			</div>
			{% endif %}
		</div>
	</div>
	{% endfor %}
</div>
{% endblock %}