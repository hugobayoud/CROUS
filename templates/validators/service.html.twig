{% import _self as formMacros %}
{% extends "base.html.twig" %}

{% macro printDsiForm(dsiForm) %}
<div class="row form-row-center row-flex">
	<div class="col-md-4" style="display: inline-flex;">de&nbsp;&nbsp;&nbsp;{{ form_widget(dsiForm.date_deb) }}</div>
	<div class="col-md-4" style="display: inline-flex;">&nbsp;&nbsp;à&nbsp;&nbsp;&nbsp;{{ form_widget(dsiForm.date_fin) }}</div>
</div>
{% endmacro %}

{% block body %}
<div class="text-center" style="margin-top: 30px;">
	<h1>Gestion des valideurs pour le service {{ service.libelle_court }}</h1> 
	<p>
		<em>Modifier les droits de valideur pour un agent de ce service en cliquant sur celui-ci</em>
	</p>
</div>

<div class="previous-link">
	<a href="{{ path('valideurs.home') }}">Page précédente</a>
</div>

<table id="table" class="table">
	<thead class="thead-crous">
		<th></th>
		<th >Nom</th>
		<th >Prénom</th>
		<th>Email</th>
		<th style="text-align: center;">Actuellement valideur</th>
	</thead>
	<tbody>
		{% if users is empty %}
		<tr>
			<td colspan="5">Il n'existe pas d'agent pour ce service</td>
		</tr>
		{% else %}
		{% for user in users %}
			<tr>
				<td class="vert-middle"><a class="flip pencil" href="#user_detail_{{ loop.index0 }}"></a></td>
				<td class="vert-middle"><strong>{{ user.nom }}</strong></td>
				<td class="vert-middle"><strong>{{ user.prenom }}</strong></td>
				<td class="vert-middle">{{ user.email }}</td>
				<td style="text-align: center;" class="vert-middle">{#{% if user.verifyCurrentValideur(service.id) %}yes-dsi"><em>oui</em>{% else %}no-dsi"><em>non</em>{% endif %}#}</td>
				{# <td class="vert-middle"><a class="flip pencil" href="#user_detail_{{ loop.index0 }}"></a><a class="trash" href=""></a></td> #}
			</tr>
		{% endfor %}
		{% endif %}
		
	</tbody>
</table>

{# {% for message in app.flashes('message') %}
<div class="alert alert-success" role="alert">
	{{ message }}
</div>
{% endfor %}
{% for message in app.flashes('warning') %}
<div class="alert alert-danger" role="alert">
	{{ message }}
</div>
{% endfor %}

<div class="detail-box">

	{% for form in forms %}
	{% form_theme form 'bootstrap_4_layout.html.twig' %}
	<div class="panel" id="user_detail_{{ loop.index0 }}">
		
		<p>
			Gestion des périodes d'accès à la fonction valideur de ce service<br>
			<strong>{{ users[loop.index0].prenom }} {{ users[loop.index0].nom }}</strong>
		</p>
		{{ form_start(form) }}
			<div class="form-error">
					{{ form_errors(form)}}
			</div>
			<div class="dsis_{{ loop.index0 }}" data-prototype="{{ formMacros.printDsiForm(form.dsis.vars.prototype)|e('html_attr') }}">
				{% for dsiForm in form.dsis %}
					{{ formMacros.printDsiForm(dsiForm) }}
				{% endfor %}
			</div>
			<hr>
			<div class="save-div">
				{{ form_widget(form.save, {'label': 'Enregistrer', 'attr': {'class': 'save-button'}}) }}
			</div>
			<input type="hidden" id="custId" name="custId" value="{{ loop.index0 }}">
		{{ form_end(form) }}

	</div>
	{% endfor %}

</div> #}
{% endblock %}